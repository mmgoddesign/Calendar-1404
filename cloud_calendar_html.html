<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>تقویم 1404 ابری</title>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<style>
body { font-family: Tahoma, sans-serif; background: #f0f0f0; }
table { border-collapse: collapse; margin: 20px auto; border-radius: 10px; overflow: hidden; }
th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
th { background: #ffb6c1; }
td { background: #ffe4e1; cursor: pointer; width: 40px; height: 40px; }
td.done { background: #90ee90 !important; }
td.failed { background: #ff7f7f !important; }
.month-title { text-align: center; font-size: 20px; margin-top: 30px; }
</style>
</head>
<body>
<h1 style="text-align:center;">تقویم 1404 ابری</h1>
<div id="calendar"></div>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyDGfJHHIpwIoAXXFuKIgtS0nsdny5GjUYU",
  authDomain: "mycalendar-2c260.firebaseapp.com",
  databaseURL: "https://mycalendar-2c260-default-rtdb.firebaseio.com/",
  projectId: "mycalendar-2c260",
  storageBucket: "mycalendar-2c260.appspot.com",
  messagingSenderId: "494039769096",
  appId: "1:494039769096:web:2fd5338ff141936aa971bd"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ماه‌ها و روزها
const months = ["شهریور","مهر","آبان","آذر","دی","بهمن","اسفند"];
const days = ["ش","ی","د","س","چ","پ","ج"];
const monthDays = [30,30,30,30,30,30,29];

const calendarDiv = document.getElementById('calendar');

function createCalendar(){
  months.forEach((month, idx)=>{
    let html = `<div class='month-title'>${month}</div>`;
    html += `<table><tr>`;
    days.forEach(d=>{ html += `<th>${d}</th>` });
    html += `</tr><tr>`;

    for(let i=1;i<=monthDays[idx];i++){
      html += `<td data-month='${idx}' data-day='${i}'></td>`;
      if((i+0)%7===0) html += `</tr><tr>`; // خط جدید هر 7 روز
    }
    html += `</tr></table>`;
    calendarDiv.innerHTML += html;
  });
}

createCalendar();

// بارگذاری وضعیت از Firebase
function loadStatus(){
  months.forEach((month, idx)=>{
    for(let i=1;i<=monthDays[idx];i++){
      const cell = document.querySelector(`td[data-month='${idx}'][data-day='${i}']`);
      db.ref(`calendar/month${idx}/day${i}`).once('value').then(snapshot=>{
        const val = snapshot.val();
        if(val==='done') cell.classList.add('done');
        if(val==='failed') cell.classList.add('failed');
      });
    }
  });
}

loadStatus();

// کلیک روی روزها
calendarDiv.addEventListener('click', e=>{
  if(e.target.tagName==='TD'){
    const month = e.target.getAttribute('data-month');
    const day = e.target.getAttribute('data-day');
    if(e.target.classList.contains('done')){
      e.target.classList.remove('done');
      e.target.classList.add('failed');
      db.ref(`calendar/month${month}/day${day}`).set('failed');
    } else if(e.target.classList.contains('failed')){
      e.target.classList.remove('failed');
      db.ref(`calendar/month${month}/day${day}`).set(null);
    } else {
      e.target.classList.add('done');
      db.ref(`calendar/month${month}/day${day}`).set('done');
    }
  }
});
</script>
</body>
</html>
